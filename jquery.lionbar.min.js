(function(a){a.fn.lionbar=function(c){var d=a.extend({always_show_scrollbars:false,scrollspeed:30,draggable_scroller:true},c);var b={init:function(g){g.addClass("lionbar").css({position:"relative",overflow:"hidden",height:g.height()});if(!g.children(".lionbar-inner").length){g.wrapInner('<div class="lionbar-inner"></div>')}if(!g.children(".lionbar-scroller").length){g.append('<div class="lionbar-scroller"></div>')}var i=g.children(".lionbar-inner");i.css({position:"absolute",left:0,top:0,paddingRight:"3px"});var h=g.children(".lionbar-scroller");var e=(i.height()>g.height());var f=e?(g.height()/i.height())*g.height():0;h.css({position:"absolute",top:0,right:0,height:f,backgroundColor:"#000",opacity:0.5,width:"3px",borderRadius:"3px"});if(!d.always_show_scrollbars){h.fadeOut()}if(e){i.bind("touchstart",b.handle_touch_start);i.bind("touchmove",b.handle_touch_move);i.bind("touchend",b.handle_touch_end)}if(e&&d.draggable_scroller){b.draggable_scroller.init(g,h,i)}return e},normalize_scroll:function(e){var f={delta:0,deltaX:0,deltaY:0};if(e.originalEvent!==undefined){e=e.originalEvent}if(e.wheelDelta){f.delta=e.wheelDelta/120}if(e.detail){f.delta=-e.detail/3}f.deltaY=f.delta;if(e.axis!==undefined&&e.axis===e.HORIZONTAL_AXIS){f.deltaY=0;f.deltaX=-1*delta}if(e.wheelDeltaY!==undefined){f.deltaY=e.wheelDeltaY/120}if(e.wheelDeltaX!==undefined){f.deltaX=-1*e.wheelDeltaX/120}return f},handle_mousewheel:function(e){e.preventDefault();e.stopImmediatePropagation();var i=a(this);var m=i.children(".lionbar-inner");var f=i.children(".lionbar-scroller");var g=b.normalize_scroll(e);var h=g.deltaY*d.scrollspeed;var k=parseInt(m.css("top"),10)+h;if(k>0){k=0}else{if(i.height()+Math.abs(k)>m.height()){k=-(m.height()-i.height())}}m.css({top:k});var l=Math.abs(k)/(m.height()-i.height());var j=(i.height()-f.height())*l;f.css({top:j})},handle_touch_start:function(f){f.preventDefault();var h=a(this);var g={innerY:0,innerX:0,doing_drag:true};if(!d.always_show_scrollbars){h.siblings(".lionbar-scroller").fadeTo("slow",0.5)}var e=h.parent(".lionbar").offset();var i=f.originalEvent.touches[0];g.innerY=Math.abs(parseInt(h.css("top"),10))+(i.pageY-e.top);g.innerX=Math.abs(parseInt(h.css("left"),10))+(i.pageX-e.left);h.data("lionbar",g)},handle_touch_move:function(e){e.preventDefault();e.stopImmediatePropagation();var k=a(this);var j=k.data("lionbar");var o={innerY:0,innerX:0};if(j.doing_drag){j.doing_drag=true;var h=k.parent(".lionbar");var m=parseInt(k.css("top"),10);var f=h.offset();var i=e.originalEvent.touches[0];o.innerY=Math.abs(parseInt(k.css("top"),10))+(i.pageY-f.top);o.innerX=Math.abs(parseInt(k.css("left"),10))+(i.pageX-f.left);m+=(o.innerY-j.innerY);if(m>0){m=0}else{if(h.height()+Math.abs(m)>k.height()){m=-(k.height()-h.height())}}k.css({top:m});var g=k.siblings(".lionbar-scroller");var n=Math.abs(m)/(k.height()-h.height());var l=(h.height()-g.height())*n;g.css({top:l})}k.data("lionbar",j)},handle_touch_end:function(e){e.preventDefault();var f=a(this);if(!d.always_show_scrollbars){f.siblings(".lionbar-scroller").fadeOut("slow")}f.data("lionbar",{innerY:0,innerX:0,doing_drag:false})},draggable_scroller:{init:function(g,h,f){var e=this;var j=g;var i=h;var k=f;i.mousedown(function(l){l.preventDefault();l.stopImmediatePropagation();i.data("start_y",(l.clientY-i.offset().top));i.data("mousedown",true);a(document).on("mousemove.lionbar_draggable_scroller",{scroller:i},e.mousemove);a(document).on("mouseup.lionbar_draggable_scroller",function(m){a(document).off(".lionbar_draggable_scroller");i.data("start_y",undefined);i.data("mousedown",false)})})},mousemove:function(e){var f=e.data.scroller;if(!f.data("mousedown")){return}e.stopImmediatePropagation();e.preventDefault();var p=f.closest(".lionbar");var o=f.siblings(".lionbar-inner");var q=f.height();var h=p.height();var m=h-q;var i=o.height()-h;var n=f.data("start_y");var g=e.clientY-p.offset().top;var l=e.clientY-f.offset().top;if(g<=0){f.css({top:0});o.css({top:0});return}else{if(g>p.height()){f.css({top:m});o.css({top:(i-h)})}}var j=g-n;if(j<=0){j=0}else{if(m<j){j=m}}f.css({top:j});var k=j/m;o.css({top:-(i*k)})}}};return this.each(function(){var g=a(this);var f=false;var e=b.init(g);var i=g.children(".lionbar-inner");var h=g.children(".lionbar-scroller");i.data("lionbar-resize",{w:i.width(),h:i.height()});g.hover(function(){f=true;if(!d.always_show_scrollbars){h.fadeTo("slow",0.5)}if(e){g.bind("mousewheel DOMMouseScroll",b.handle_mousewheel);g.bind("touchstart",b.handle_touch_start);g.bind("touchmove",b.handle_touch_move);g.bind("touchend",b.handle_touch_end)}},function(){f=false;if(!d.always_show_scrollbars){h.fadeOut("slow")}g.unbind("mousewheel touchstart touchmove touchend")});setInterval(function(){var j=i.data("lionbar-resize");if(j.h!=i.height()){e=b.init(g);i.data("lionbar-resize",{w:i.width(),h:i.height()});if(e&&f){if(!d.always_show_scrollbars){h.fadeTo("slow",0.5)}g.bind("mousewheel DOMMouseScroll",b.handle_mousewheel);g.bind("touchstart",b.handle_touch_start);g.bind("touchmove",b.handle_touch_move);g.bind("touchend",b.handle_touch_end)}}},1000)})}})(jQuery);